## Multi Thread

### 쓰레드

- 애플리케이션 코드를 순차적으로 실행
- 쓰레드가 없으면 자바 애플리케이션 실행 불가
- 쓰레드는 한번에 하나 코드 라인 수행, 동시 처리가 필요하면 쓰레드 추가 생성

### 요청마다 쓰레드 생성할 경우 장단점

- 장점
  - 동시 요청을 처리할 수 있음
  - 리소스가 허용할 때 까지 처리가능
  - 하나의 쓰레드가 지연되어도, 나머지 쓰레드 동작

- 단점
  - 쓰레드 생성 비용이 비쌈
  - 쓰레드는 컨텍스트 스위칭 비용 발생
  - 쓰레드 생성에 제한이 없음(너무 많으면 서버 죽을 수 있음)

### 쓰레드 풀(요청마다 쓰레드 생성의 단점 보완)

- 특징
  - 필요한 쓰레드를 쓰레드 풀에 보관하고 관리
  - 쓰레드 풀에 생성 가능한 쓰레드의 최대치 관리
- 사용
  - 쓰레드가 필요하면 쓰레드 풀에서 꺼내서 사용
  - 사용 종료 후 반납
- 장점
  - 미리 생성되어 있어, 생성 종료 비용 절감 및 응답시간 빠름
  - 최대치가 있어 안전하게 사용 가능
- 실무 팁
  - WAS 주요 튜닝 포인트는 최대 쓰레드 수
  - 너무 낮으면 서버 리소스 여유롭지만 응답지연, 너무 높으면 요청이 많으면 서버 다운 가능
- 쓰레드 풀의 적정 숫자
  - 애플리케이션 로직의 복잡도, CPU, 메모리, IO 리소스 상황에 따라 다름
  - 성능 테스트
    - 최대한 실제 서비스와 유사하게 성능 테스트 시도
    - 툴 : 아파치 ab, 제이미터, nGrinder

### WAS의 멀티 쓰레드 지원

- 멀티 쓰레드에 대한 부분은 WAS가 처리
- 개발자가 멀티 쓰레드 관련 코드를 신경쓰지 않아도 됨
- 개발자는 마치 싱글 쓰레드 프로그래밍을 하듯이 편리하게 소스 코드를 개발
- 멀티 쓰레드 환경이므로 싱글톤 객체(서블릿, 스프링 빈)는 주의해서 사용