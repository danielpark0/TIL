파이프 라인 구조 VS 병렬적인 다중 기능 장치

- 실제 파이프라인 구조가 이론적인 최대 속도를 구현하지 못하는 이유
  - 각 세그먼트 들이 부연산을 수행하는 시간이 서로 다르다.
  - 또한 각 레지스터를 제어하는 클럭 사이클은 최대 전파시간을 갖는 세그먼트의 지연시간과 싱크를 마추어야 한다.

- 파이프 라인 구조가 적용되는 컴퓨터 설계
  - 산술 파이프 라인 : 산술 연산들을 부연산으로 나누어 파이프 라인의 세그먼트에서 수행
  - 명령어 파이프 라인 : 명령어 사이클의 fetch, 디코드, 실행단계를 중첩 시킴으로 명령어 흐름에 동작

- 명령어 실행과 파이프 라인 구조
  - 명령어 파이프라인은 이정 명령어가 다른 세그먼트에서 실행되고 있는 동안 메모리에 연속적으로 저장되어 있는 다음 명령어를 읽어옴으서 fetch와 실행이 중첩되어 동시에 수행되는 구조이다.
  - 분기가 발생 할 경우(가장 큰 취약점) - 현재의 파이프라인은 모두 비워져야하고, 분기명령 이후에 메모리에서 읽어온 명령어는 모두 무시되어야 한다.
  - 명령어 fetch 장치와 명령어 실행 장치로서 두  세그먼트 파이프라인을 구성하는 컴퓨터를 고려
    - 명령어 fetch장치 -> FIFO에 의한 Queue로 구성되어 queuing 기법에 의한 메모리 참조에 의해 평균 메모리 접근 시간을 효과적으로 줄여 준다.
  - 명령어 파이프라인이 수행되는데 있어 발생하는 애로 사항
    - 세먼트의 수행시간이 서로 다름
    - 두개 이상의 세그먼트에 의해 동일한 주소 공간이 참조되는경우

- 명령어 파이프라인이 정상적인 동작에서 벗어나게 되는 요인
  - 자원충돌 : 두 세그먼트가 동시에 메모리를 접근하려고 하는데서 기인 -> 명령어 메모리와 데이터 메모리를 분리함으로써 대부분 해결
  - 데이터 의존성 : 충돌은 어떤 명령어가 이전 명령어의 결과에 의존하여 수행되는데, 그 값이 아직 준비되지 않은 경우에 발생한다.
  - 분기 곤란 : 분기 명령어 같이 PC의 값을 변경 시키려는 명령어에 의해 발생한다.

- 데이터 의존성

  - 데이터나 주소의 충돌은 명령어 파이프라인의 성능을 저하시키는 요인
    - 데이터 의존성 : 아직 준비되지 않은 데이터를 기다리는 경우
    - 주소 의존성 : 마이크로 연산 시 레지스터 간접모드를 사용하는 명령어는 이전 명령어가 주소 값을 메모리로부터 로드하는 명령어 라면 곧바로 피연산자를 fetch하지 못하고 기다리게 된다.

  - 데이터 의존성 해결 방법
    - 하드웨어 인터락 : 어떤 명령어의 피 연산자가 파이프라인에서 앞서간 명령어의 목적지와 일치하는지를 검사하는 회로 -> 이러한 상황이 감지되면 피연산자가 준비되지 않은 명령어는 충돌을 피할 수 있을 만큼 충분한 클럭 사이클 두어 지연시킨다.
    - 오퍼랜드 포워딩 : 충돌을 감지하는 경우 특별한 통로를 통해 직접 파이프라인 세그먼트에 전달하는 경우

  - 분기 명령어의 처리
    - 조건 분기 또는 무조건 분기 등은 처리 여하에 따라 파이프라인의 정상적인 프로그램 순서를 바꾸어 버리기 때문에 파이프라인 시스템을 채택하고 있는 컴퓨터의 성능을 저하시키는 주 요인으로 간주되고 있다.
      - 순차적으로 처리될 명령어를 분기의 목표가 되는 명령어와 함께 저장하는 방법
      - 분기 목표 버퍼의 사용 : fetch 세그먼트에 속해 있는 associative memory : 이전에 실행된 분기 명령어와 분기 목표 명령어를 저장하여 활용

  - 분기 예측
    - 실제 다양한 프로그램의 실행 결과를 분석한 결과 참조의 시간적 지역성과 유사하게 일부 명령어들은 반복 수행되며 반복 실행시에는 규칙성을 갖는다.
    - 이러한 예측 기법을 이용하여 분기 및 적재 명령어가 참조하는 오퍼랜드도 반복 참조 시 규칙성을 갖고 있으며 이를 이용할 경우 명령어 fetch 과정에서 신속하게 오퍼랜드의 제공 및 fetch가 수월해 질 수 있다 다만 예측실패시 지불해야할 패널티(시간지연)가 있을 수 있다.

- Risc Processor

  - Risc 프로세서 설계 목표
    - 실행명령어 수는 증가하더라도 작업처리 시간의 감소가 가능하다.
    - 명령어당 실행 클록 수와 클록 주기를 파이프라인 구조를 이용하여 감소시킬 수 있다.

  - Risc 프로세서의 구조적 특징
    - 명령어의 1 사이클 실행을 위한 파이프 라인 구조, 메모리 참조를 위한 온칩 캐쉬
    - 간단한 명령 코드와 주소 지정 모드 및 하드와이어 적 제어 장치
    - 신속한 오퍼랜드 참조 / 문맥 전환을 위한 레지스터 집합
    - 실수 연산의 별도 처리를 위한 코프로세서

  - Risc 파이프 라인
    - 명령어 사이클은 세개의 부연산으로 나뉘어 다음과 같은 세 세그먼트로 구성
      I : 명령어의 fetch
      A : ALU의 동작
      E : 명령어의 실행

- 파이프라인 CPU 성능 분석

  이론적으로는 명령어 세그먼트의 횟수가 많아질수록 파이프라인의 이로적 최대속도가 증가할 것으로 분석 되었으나 실제 상황은 그렇게 단순하지 않다.

  - 모든 명령어는 동일한 처리과정(세그먼트의 적용)으로 처리 되어야 한다.
  - 파이프라인을 구성하는 각 단계의 처리 시간이 일정해야 한다.
  - 모든 명령어는 작성된 순서에 따라 순차적으로 실행되어야 한다.
  - 사용 명령어들 사이에는 상호 의존성이 없어야 한다.
  - 명령어들 처리 시 공유 자원의 충돌이 없어야 한다.