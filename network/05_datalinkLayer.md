# 데이터 링크 계층

- 역할
  - OSI7 Layer의 2계층으로 인전합 네트워크 노드끼리 데이터를 전송하는 기능과 절차를 제공
  - 물리 계층에서 발생할 수 있는 오류를 감지하고 수정
  - 대표적인 프로토콜로 이더넷이 있으며 장비로는 스위치가 있다.

- 2개의 부계층으로 구성
  - MAC : 물리적인 부분으로 매체간의 연결방식을 제어하고 1계층과 연결
  - LLC : 논리적인 부분으로 Frame을 만들고 3계층과 연결

- MAC 주소
  - 48 bit 6자리로 구성, 각 16진수로 표현

- 주요기능
  - Framing : 데이터 그램을 캡슐화하여 프레임 단위로 만들고 헤와 트레일러를 추가
    - 헤더는 목적지, 출발지 주소 그리고 데이터 내용을 정의
    - 트레일러는 비트 에러를 감지
  - 회선 제어 : 신호간의 충돌이 발생하지 않도록 제어
    - ENQ/ACK 방법 - 전용 전송 링크 1:1
    - Polling 방법 - 1:다 
      - Select 모드 : 송신자가 나머지 수신자를 선택하여 전송
      - Poll 모드 : 수신자에게 데이터 수신 여부를 확인하여 응답을 확인하고 전송 - multipoint
  - 흐름 제어 : 송신자와 수신자의 데이터를 처리하는 속도 차이를 해결하기 위한 제어
    - Feedback 방식의 Flow Control이며 상위 계층은 Rate 기반
      - Stop & Wait
      - Sliding window : ACK 응답 없이 여러개의 프레임이 연속으로 전송 가능
  - 오류 제어 : 전송 중에 오류나 손실 발생 시 수신측은 에러를 탐지 및 재전송
    - ARQ : 프레임 손상 시 재전송이 수행되는 과정

- 스위치
  - 2계층의 대표적인 장비로 MAC주소 기반 통신
  - 허브의 단점을 보완 Half duplex -> Full duplex
  - 동작방식 : 목적지 주소를 MAC 주소 테이블에서 확인하여 연결된 포트로 프레임 전달
    1. Learning : 출발지 주소가 MAC 주소 테이블에 없으면 해당 주소를 저장
    2. Flooding - Broadcasting : 목적지 주소가 MAC 주소 테이블에 없으면 전체 포트로 전달
    3. Forwarding : 목적지 주소가 MAC 주소 테이블에 있으면 해당 포트로 전달
    4. Filtering - Collision Domain : 출발지와 목적지가 같은 네트워크 영역이면 다른 네트워크로 전달하지 않음
    5. Aging : MAC 주소 테이블의 각 주소는 일정 시간 이후에 삭제

- ARP

  - Address Resolution Protocol
  - IP 주소를 통해서 MAC 주소를 알려주는 프로토콜
  - 컴퓨터 A가 컴퓨터 B에게 IP통신을 시도하고 통신을 수행하기 위해 목적지 MAC 주소를 알아야한다.
  - 목적지 IP에 해당되는 MAC 주소를 알려주는 역할을 ARP가 해준다.

  - 동작 과정
    1. PC 1은 동일 네트워크 대역인 목적지 IP로 패킷 전송을 시 목적지 MAC 주소를 알기위해 우선 자신의 ARP Cache Table을 확인
    2. ARP Cache Table에 있으면 패킷 전송, 없으면 ARP Request 전송 - Broadcasting
    3. IP 에서 목적지 MAC 주소를 ARP Reply로 전달
    4. 목적지 MAC 주소는 ARP Cache Table에 저장되고 패킷 전송

- Looping
  - 같은 네트워크 대역대에서 스위치에 연결된 경로가 2개 이상인 경우에 발생

- STP : 스패닝 트리 프로토콜
  - 자동으로 루핑을 막아주는 알고리즘
    1. Bridge ID : 스위치의 우선순위로 0 ~ 65535로 설정, 낮을 수록 우선순위 농픔
    2. Path Cost : 링크의 속도, 1000/링크 속도로 계산되며 작을수록 우선순위가 높다.
  - 상태변화 : 스위치 포트는 스패닝 트리 프로ㅗ콜 안에서 5가지 상태로 표현
    1. Disabled
    2. Blocking
    3. Listening
    4. Learning
    5. Forwarding

- VLAN

  - 물리적 구성이 아닌 논리적인 가상의 LAN을 구성하는 기술
  - 불필요한 데이터 차단 : 브로드캐스트 도메인 별로 나누어 관리
  - 관리의 용이성과 보안 : 호스트의 물리적 이동 없이 LAN 그룹 변경이 가능
  - 비용 절감 : 새로운 LAN 추가시 물리적 스위치 구매 필요 없음
  - 종류
    1. Port 기반 VLAN
    2. MAC 주소 기반 VLAN
    3. IP 주소 기반 VLAN

  - Trunk : 물리적 스위치간 VLAN 연결 시 하나의 물리적 연결로 VLAN 그룹들 공유